{% extends "_base.html" %}

{% load fullurl %}
{% load avatar_tags %}
{% load guard %}

{% block custom_header %}
<div class="container-fluid init-index-header">
    <div class="container">
        <div class="row title">
            <div class="col-12 text-center" style="padding-top: 3rem; padding-bottom: 3rem">
                <h1 class="display-4">Initiativplattform</h1>
            </div>
        </div>
    </div>
</div>

<form id="filters" method="GET">
	<div class="typefilter">
		<div class="container">
			<div class="row no-gutters">
				<div class="col-auto">
			      <h6>
			      	<i class="material-icons filter-list">filter_list</i> Zeige nur:
			      </h6>
	    		</div>
	    		<div class="col-sm-10">
				  	<div class="row no-gutters">
						{% if user.is_authenticated %}
						<div class="col-auto">
							<label>
								<input name="f" value="p" type="checkbox" {% if 'p' in filters %} checked{% endif %}>
								<span class="badge badge-prepare">
						      		In Vorbereitung ({{counts.p}})
						      	</span>
							</label>
						</div>
							{% if counts.i %}
						    <div class="col-auto">
							    <label>
							      	<input name="f" value="i" type="checkbox" {% if 'i' in filters %} checked{% endif %}>
							      	<span class="badge badge-arrivals">
							      		In Prüfung ({{counts.i}})
							      	</span>
							    </label>
							</div>
					      	{% endif %}
						{% endif %}
				      	<div class="col-auto">
						    <label>
						      	<input name="f" value="s" type="checkbox" {% if 's' in filters %} checked{% endif %}>
						      	<span class="badge badge-support">
						      		Sucht Unterstützung ({{counts.s}})
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="d" type="checkbox" {% if 'd' in filters %} checked{% endif %}>
						      	<span class="badge badge-discussion">
						      		In Diskussion ({{counts.d}})
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="e" type="checkbox" {% if 'e' in filters %} checked{% endif %}>
						      	<span class="badge badge-edits">
						      		Finale Überarbeitung ({{counts.e}})
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="m" type="checkbox" {% if 'm' in filters %} checked{% endif %}>
						      	<span class="badge badge-arrivals">
						      		Finale Prüfung
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="v" type="checkbox" {% if 'v' in filters %} checked{% endif %}>
						      	<span class="badge badge-vote">
						      		Abstimmung ({{counts.v}})
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="a" type="checkbox" {% if 'a' in filters %} checked{% endif %}>
						      	<span class="badge badge-accepted">
						      		Angenommen ({{counts.a}})
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="r" type="checkbox" {% if 'r' in filters %} checked{% endif %}>
						      	<span class="badge badge-rejected">
						      		Abgelehnt ({{counts.r}})
						      	</span>
						    </label>
						</div>
					</div>
				</div>
			</div>
		</div>
    </div>
 </form>
{% endblock %}

{% block content %}
<div class="container init-index">
	{% for initiative in initiatives %}
		{% include "fragments/initiative/card.html" %}
	{% empty %}
	<div class="card">
		<div class="card-block">
			<em>Keine Initiativen gefunden, die Deiner Suche entsprechen.</em>
		</div>
	</div>
	{% endfor %}
</div>

{% endblock %}

{% block body-javascript %}

{{ block.super }}

<script type="text/javascript">
  	$(function(){
  		var submitTimeout = null;
	    $('.typefilter input').change(function(item) {
	    	if (submitTimeout) window.clearTimeout(submitTimeout);
	    	submitTimeout = window.setTimeout(function() {
	    		$("#filters").submit();
	    	}, 900);

	    });	
  	});
</script>
{% endblock %}
